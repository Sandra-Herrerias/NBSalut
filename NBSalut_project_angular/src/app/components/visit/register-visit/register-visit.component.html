<nav class="navbar navbar-expand-lg navbar-light bg-light pt-5 pb-4">
   <div class="container-fluid">
      <div class="container">
         <h2>REGISTRO DE VISITA</h2>
      </div>
   </div>
</nav>

<!-- Select check type -->
<div *ngIf="!patientExist" class="container mt-5">
   <div class="row">
      <div class="col-3">
         <form [formGroup]="checkTypeForm">
            <label class="form-label fw-bold">Método de validación *</label>
            <select class="form-select" formControlName="checkType" required>
               <option value="dni">DNI</option>
               <option value="name">Nombre completo</option>
            </select>
         </form>
      </div>
   </div>
</div>

<!-- CHECK FORMS -->

<!-- Dni Form -->
<div *ngIf="!patientExist && checkTypeForm.value.checkType == 'dni'" class="container mt-5">
   <form [formGroup]="validatePatientFormDni">
      <div class="row mb-3">
         <!-- Patient field -->
         <div class="mb-3 col-3">
            <label class="form-label fw-bold">Introduce DNI del paciente *</label>
            <input type="text" formControlName="dni" class="form-control" required>
            <label class="text-danger mt-1"
               *ngIf="registerVisitForm.get('dni')?.errors?.['required'] && registerVisitForm.get('dni')?.touched">DNI
               requerido
            </label>
         </div>
      </div>
      <div class="row text-center mt-2">
         <button type="button" class="btn btn-primary col-3" [disabled]="validatePatientFormDni.invalid"
            (click)="checkPatientDni()">Buscar Paciente</button>
      </div>
   </form>
</div>

<!-- Name Form -->
<div *ngIf="!patientExist && checkTypeForm.value.checkType == 'name'" class="container mt-5">
   <form [formGroup]="validatePatientFormName">
      <div class="row mb-3">
         <!-- Patient field -->
         <div class="mb-3 col-3">
            <label class="form-label fw-bold">Introduce Nombre del paciente *</label>
            <input type="text" formControlName="name" class="form-control" required>
            <label class="text-danger mt-1"
               *ngIf="registerVisitForm.get('name')?.errors?.['required'] && registerVisitForm.get('name')?.touched">DNI
               requerido
            </label>
         </div>
         <div class="mb-3 col-3">
            <label class="form-label fw-bold">Introduce los Apellidos del paciente *</label>
            <input type="text" formControlName="surname" class="form-control" required>
            <label class="text-danger mt-1"
               *ngIf="registerVisitForm.get('surname')?.errors?.['required'] && registerVisitForm.get('surname')?.touched">DNI
               requerido
            </label>
         </div>
      </div>
      <div class="row text-center mt-2">
         <button type="button" class="btn btn-primary col-3" [disabled]="validatePatientFormName.invalid"
            (click)="checkPatientName()">Buscar Paciente</button>
      </div>
   </form>
</div>

<!-- REGISTER FORM -->

<!-- Main Form -->
<div *ngIf="patientExist" class="container mt-5">
   <div class="row">
      <div class="col-6">
         <form [formGroup]="registerVisitForm">
            <!-- Inputs -->
            <div class="row mb-3">
               <!-- CH Number field -->
               <div class="mb-3 col-4">
                  <label class="form-label fw-bold">Nº del historial clínico *</label>
                  <input type="text" formControlName="numHis" class="form-control" required>
                  <label class="text-danger mt-1"
                     *ngIf="registerVisitForm.get('numHis')?.errors?.['required'] && registerVisitForm.get('numHis')?.touched">Nº
                     del historial
                     requerido
                  </label>
               </div>
               <!-- Name field -->
               <div class="mb-3 col-4">
                  <label class="form-label fw-bold">Nombre *</label>
                  <input type="text" formControlName="name" class="form-control" required>
                  <label class="text-danger mt-1"
                     *ngIf="registerVisitForm.get('name')?.errors?.['required'] && registerVisitForm.get('name')?.touched">Nombre
                     requerido
                  </label>
               </div>
               <!-- Surnames field -->
               <div class="mb-3 col-4">
                  <label class="form-label fw-bold">Apellidos *</label>
                  <input type="text" formControlName="surnames" class="form-control" required>
                  <label class="text-danger mt-1"
                     *ngIf="registerVisitForm.get('surnames')?.errors?.['required'] && registerVisitForm.get('surnames')?.touched">Apellidos
                     requerido
                  </label>
               </div>
               <!-- Visit date field -->
               <div class="mb-3 col-6">
                  <label class="form-label fw-bold">Fecha de la visita *</label>
                  <input type="date" formControlName="date" class="form-control" readonly>
                  <label class="text-danger mt-1"
                     *ngIf="registerVisitForm.get('date')?.errors?.['required'] && registerVisitForm.get('date')?.touched">Fecha
                     requerida
                  </label>
               </div>
               <!-- Treatment field -->
               <div class="mb-3 col-6">
                  <label class="form-label fw-bold">Tratamiento *</label>
                  <!-- <select class="form-select" formControlName="treat" aria-label="Default select example" required>
                     <option *ngFor="let t of listTreatments" value={{t.name}}>{{t.name}}</option>
                  </select>
                  <label class="text-danger mt-1"
                     *ngIf="registerVisitForm.get('treat')?.errors?.['required'] && registerVisitForm.get('treat')?.touched">Tratamiento
                     requerida
                  </label> -->
                  <div>
                     <ng-multiselect-dropdown [placeholder]="'Seleccionar tratamientos'"
                        [settings]="selectTreatmentsOptions" [data]="listTreatments" formControlName="treat"
                        (onSelect)="onItemSelect()" (onSelectAll)="onSelectAll()" (onDeSelect)="onItemSelect()">
                     </ng-multiselect-dropdown>
                  </div>
               </div>
               <!-- Description field -->
               <div class="mb-3 col-12">
                  <label class="form-label fw-bold">Descripción de la visita</label>
                  <textarea name="des" class="form-control" placeholder="Escribe aquí..." style="height: 100px"></textarea>
               </div>
               <div class="mb-3 col-8">
                  <label class="form-label fw-bold">Documento adjunto</label>
                  <input class="form-control" type="file" id="file">
               </div>
               <div class="mb-3 col-4">
                  <label class="form-label fw-bold">Facturación</label><br>
                  <button type="button" class="btn btn-primary col-12" data-bs-toggle="modal"
                     data-bs-target="#staticBackdrop">
                     Generar
                  </button>
               </div>
            </div>  
   
            <!-- Submit button -->
            <div class="row text-center mt-5">
               <div class="col-4"></div>
               <button type="button" class="btn btn-primary btn-lg col-4" [disabled]="registerVisitForm.invalid"
                  (click)="addVisit()">Registrar visita</button>
               <div class="col-4"></div>
            </div>
         </form>
      </div>
      <div class="col-6">
         <h2>Visits table</h2>
         <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Paciente</th>
                    <th>Fecha de visita</th>
                    <th>Precio</th>
                    <th>Descripción de la visita </th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let visit of listVisits">
                    <td>{{visit.id}}</td>
                    <td>{{visit.patient}}</td>
                    <td>{{visit.date}}</td>
                    <td>{{visit.price}}</td>
                    <td>{{visit.id}}</td>
                </tr>
            </tbody>
        </table>
      </div>
   </div>
</div>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
   aria-labelledby="staticBackdropLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Facturación</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
         </div>
         <div class="modal-body">
            <table class="table table-striped">
               <thead>
                  <tr>
                     <th scope="col">#</th>
                     <th scope="col">First</th>
                     <th scope="col">Last</th>
                     <th scope="col">Handle</th>
                  </tr>
               </thead>
               <tbody>
                  <tr>
                     <th scope="row">1</th>
                     <td>Mark</td>
                     <td>Otto</td>
                     <td>@mdo</td>
                  </tr>
               </tbody>
            </table>
         </div>
         <div class="modal-footer">
            <button type="button" class="btn btn-primary">Aceptar</button>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
         </div>
      </div>
   </div>
</div>